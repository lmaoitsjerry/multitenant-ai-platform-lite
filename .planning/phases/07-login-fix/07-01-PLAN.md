# Plan 07-01: Fix Frontend Dashboard Login

## Frontmatter
```yaml
wave: 1
depends_on: []
files_modified:
  - src/api/admin_routes.py
  - scripts/create_test_user.py
autonomous: true
```

## Context

**Problem:** User cannot login to the frontend dashboard.

**Root Cause Analysis:**
1. Login requires TWO things: (a) Supabase auth.users record, (b) organization_users record
2. 52 tenant YAML configs exist but only 1 tenant (africastay) has database records
3. Frontend .env uses tenant `tn_6bc9d287_84ce19011671` which has NO users in database
4. When login is attempted, auth_service.login() succeeds at Supabase auth but fails at organization_users lookup

**Evidence:**
- `frontend/tenant-dashboard/.env`: `VITE_CLIENT_ID=tn_6bc9d287_84ce19011671`
- Investigation found 52 tenant folders but only africastay has DB records
- Login flow in `auth_service.py:64-150` requires organization_users record

## Tasks

<task id="1" description="Create admin endpoint to provision test user">
**File:** `src/api/admin_routes.py`

Add a new endpoint that creates a test user for any tenant:

```python
@admin_router.post("/create-test-user")
async def create_test_user(
    tenant_id: str,
    email: str,
    password: str,
    name: str = "Test User"
):
    """
    Create a test user for a tenant (for development/testing).
    Creates both Supabase auth user and organization_users record.
    """
```

This endpoint should:
1. Accept tenant_id, email, password, name
2. Use AuthService.create_auth_user() to create both auth.users and organization_users records
3. Return success/failure with user details
</task>

<task id="2" description="Create standalone script for user creation">
**File:** `scripts/create_test_user.py`

Create a CLI script that can be run directly:

```bash
python scripts/create_test_user.py --tenant tn_6bc9d287_84ce19011671 --email test@example.com --password Test123!
```

This provides a quick way to create users without running the full API.
</task>

<task id="3" description="Create test user for the frontend tenant">
Using either the endpoint or script, create a test user:
- Tenant: `tn_6bc9d287_84ce19011671` (from frontend .env)
- Email: `admin@test.com` (or user's preferred email)
- Password: `Test123!` (or user's preferred password)
- Role: `admin`
</task>

<task id="4" description="Verify login works end-to-end">
1. Start backend: `python main.py`
2. Start frontend: `cd frontend/tenant-dashboard && npm run dev`
3. Navigate to login page
4. Enter test credentials
5. Verify successful login and dashboard access
</task>

## Verification Criteria

- [ ] Test user exists in Supabase auth.users table
- [ ] Test user has organization_users record with correct tenant_id
- [ ] Frontend login with test credentials succeeds
- [ ] Dashboard loads after login
- [ ] User info (name, email, role) displays correctly

## must_haves

1. **User can login:** A valid user credential exists that allows login
2. **Auth flow works:** Both Supabase auth AND organization_users lookup succeed
3. **Frontend connects:** The tenant_id in frontend .env matches the user's tenant
4. **Session persists:** Tokens are stored and user stays logged in

## Quick Fix Option

If you just need to login immediately, you can:

1. Use the onboarding wizard at `/admin/onboarding` to create a new tenant with admin user
2. Update `frontend/tenant-dashboard/.env` with the new tenant_id
3. Login with the admin credentials you provided during onboarding

Or use the africastay tenant (the only one with database records):
1. Change `VITE_CLIENT_ID=africastay` in `frontend/tenant-dashboard/.env`
2. Use existing africastay admin credentials (if you have them)
