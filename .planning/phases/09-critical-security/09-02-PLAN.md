---
phase: 09-critical-security
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/internal-admin/src/services/api.js
  - frontend/internal-admin/.env.example
autonomous: true

must_haves:
  truths:
    - "Admin token is NOT hardcoded in source code"
    - "Application fails clearly if VITE_ADMIN_TOKEN env var is not set"
    - "Token is only loaded from environment variable"
  artifacts:
    - path: "frontend/internal-admin/src/services/api.js"
      provides: "Admin API client without hardcoded token"
      contains: "VITE_ADMIN_TOKEN"
    - path: "frontend/internal-admin/.env.example"
      provides: "Example env file documenting required variables"
      contains: "VITE_ADMIN_TOKEN"
  key_links:
    - from: "frontend/internal-admin/src/services/api.js"
      to: "VITE_ADMIN_TOKEN"
      via: "import.meta.env"
      pattern: "import\\.meta\\.env\\.VITE_ADMIN_TOKEN"
---

<objective>
Remove hardcoded admin token from frontend internal-admin application.

Purpose: SEC-05 - The current code has a hardcoded fallback token 'zorah-internal-admin-2024' which is exposed in the source code. Anyone with access to the repository or built JS can extract this token and access admin endpoints.

Output: Frontend that requires VITE_ADMIN_TOKEN environment variable with no fallback
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/internal-admin/src/services/api.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove hardcoded admin token from api.js</name>
  <files>frontend/internal-admin/src/services/api.js</files>
  <action>
Modify frontend/internal-admin/src/services/api.js to remove the hardcoded fallback token.

Current code (line 4):
```javascript
const ADMIN_TOKEN = import.meta.env.VITE_ADMIN_TOKEN || 'zorah-internal-admin-2024';
```

Replace with:
```javascript
const ADMIN_TOKEN = import.meta.env.VITE_ADMIN_TOKEN;

// Validate admin token is configured
if (!ADMIN_TOKEN) {
  console.error(
    'FATAL: VITE_ADMIN_TOKEN environment variable is not set. ' +
    'Admin API requests will fail. Set this in your .env file.'
  );
}
```

This change:
1. Removes the hardcoded fallback 'zorah-internal-admin-2024'
2. Logs a clear error message if token is not configured
3. Does NOT throw an error (which would break the entire app) - just warns
4. API requests will fail with 401 from the backend, which is the correct behavior

The reason we warn instead of throw:
- The app might load pages that don't need admin API
- The error will be clearly visible in console
- Actual API calls will fail with 401 from backend (defense in depth)
- Build process can enforce the variable in production

Also update the axios interceptor to provide better error message when token is missing:

In the response interceptor (around line 15-21), add a check:
```javascript
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401 && !ADMIN_TOKEN) {
      console.error(
        'Admin authentication failed. Ensure VITE_ADMIN_TOKEN is set in your .env file.'
      );
    }
    console.error('API Error:', error.response?.data || error.message);
    return Promise.reject(error);
  }
);
```
  </action>
  <verify>
Read frontend/internal-admin/src/services/api.js and verify:
1. No hardcoded 'zorah-internal-admin-2024' string anywhere in the file
2. ADMIN_TOKEN is only assigned from import.meta.env.VITE_ADMIN_TOKEN
3. Warning logged if token is undefined
4. Interceptor provides helpful error message for 401 with missing token
  </verify>
  <done>
- Hardcoded admin token removed from api.js
- Clear console error when VITE_ADMIN_TOKEN not set
- Improved error messages for auth failures
- No fallback token in source code
  </done>
</task>

<task type="auto">
  <name>Task 2: Create .env.example file documenting required variables</name>
  <files>frontend/internal-admin/.env.example</files>
  <action>
Create frontend/internal-admin/.env.example file to document required environment variables.

Content:
```
# Internal Admin Panel Environment Variables
# Copy this file to .env and fill in the values

# Required: API URL for the backend
VITE_API_URL=http://localhost:8000

# Required: Admin authentication token
# SECURITY: This must match ADMIN_API_TOKEN on the backend
# Generate a secure random token: openssl rand -hex 32
VITE_ADMIN_TOKEN=

# Note: Never commit .env files with real tokens to version control
```

This provides:
1. Documentation of required variables
2. Instructions for generating secure token
3. Security reminder about not committing real tokens

Also verify .gitignore includes .env files (it likely already does, but confirm).
  </action>
  <verify>
1. Read frontend/internal-admin/.env.example and verify it exists with correct content
2. Check that .gitignore (root or frontend/internal-admin/) includes .env
  </verify>
  <done>
- .env.example created with documentation
- Required variables documented
- Security guidance included
- .env files are gitignored
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Source code check:
   - grep for 'zorah-internal-admin-2024' in entire frontend/internal-admin directory
   - Should return NO results

2. Environment variable check:
   - Verify api.js only uses import.meta.env.VITE_ADMIN_TOKEN
   - No string fallback on the same line

3. Documentation check:
   - .env.example exists and documents VITE_ADMIN_TOKEN
</verification>

<success_criteria>
- [ ] No hardcoded admin token in source code (grep returns empty)
- [ ] ADMIN_TOKEN loaded only from VITE_ADMIN_TOKEN env var
- [ ] Clear error message when token not configured
- [ ] .env.example documents required variables
- [ ] .env files are in .gitignore
</success_criteria>

<output>
After completion, create `.planning/phases/09-critical-security/09-02-SUMMARY.md`
</output>
