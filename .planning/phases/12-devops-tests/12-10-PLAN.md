---
phase: 12-devops-tests
plan: 10
type: execute
wave: 5
depends_on: ["12-07"]
files_modified:
  - tests/test_onboarding_routes.py
  - tests/test_privacy_routes.py
  - tests/test_branding_routes.py
  - tests/test_provisioning_service.py
autonomous: true

must_haves:
  truths:
    - "Onboarding routes have endpoint tests"
    - "Privacy routes have endpoint tests"
    - "Branding routes have endpoint tests"
    - "Provisioning service has unit tests"
    - "Coverage increases by at least 8%"
  artifacts:
    - path: "tests/test_onboarding_routes.py"
      provides: "Onboarding tests"
      min_lines: 150
    - path: "tests/test_privacy_routes.py"
      provides: "Privacy tests"
      min_lines: 150
    - path: "tests/test_branding_routes.py"
      provides: "Branding tests"
      min_lines: 150
    - path: "tests/test_provisioning_service.py"
      provides: "Provisioning tests"
      min_lines: 150
---

<objective>
Add tests for onboarding, privacy, branding routes and provisioning service.

Purpose: These four areas account for ~1100 uncovered lines. Testing them adds ~8% coverage.

Output: 600+ lines of tests.
</objective>

<context>
@.planning/STATE.md
@src/api/onboarding_routes.py
@src/api/privacy_routes.py
@src/api/branding_routes.py
@src/services/provisioning_service.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create onboarding routes tests</name>
  <files>tests/test_onboarding_routes.py</files>
  <action>
Create tests for tenant onboarding endpoints.

Key endpoints:
- POST /api/v1/onboarding/register
- GET /api/v1/onboarding/status
- POST /api/v1/onboarding/complete

Mock ProvisioningService. Target: 150+ lines.
  </action>
  <verify>
pytest tests/test_onboarding_routes.py -v
  </verify>
  <done>
test_onboarding_routes.py created.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create privacy routes tests</name>
  <files>tests/test_privacy_routes.py</files>
  <action>
Create tests for privacy/GDPR endpoints.

Key endpoints:
- GET /api/v1/privacy/export
- DELETE /api/v1/privacy/delete
- GET /api/v1/privacy/consent

Mock SupabaseTool. Target: 150+ lines.
  </action>
  <verify>
pytest tests/test_privacy_routes.py -v
  </verify>
  <done>
test_privacy_routes.py created.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create branding routes tests</name>
  <files>tests/test_branding_routes.py</files>
  <action>
Create tests for branding customization endpoints.

Key endpoints:
- GET /api/v1/branding
- PUT /api/v1/branding
- POST /api/v1/branding/logo

Mock storage. Target: 150+ lines.
  </action>
  <verify>
pytest tests/test_branding_routes.py -v
  </verify>
  <done>
test_branding_routes.py created.
  </done>
</task>

<task type="auto">
  <name>Task 4: Create provisioning service tests</name>
  <files>tests/test_provisioning_service.py</files>
  <action>
Create tests for ProvisioningService.

Key methods:
- create_tenant
- setup_database
- configure_email
- provision_resources

Mock all external services. Target: 150+ lines.
  </action>
  <verify>
pytest tests/test_provisioning_service.py -v
  </verify>
  <done>
test_provisioning_service.py created.
  </done>
</task>

</tasks>

<verification>
- [ ] All test files created
- [ ] All tests pass
- [ ] Coverage increases
</verification>

<success_criteria>
1. All four areas have tests
2. Coverage approaches 50%
</success_criteria>

<output>
After completion, create `.planning/phases/12-devops-tests/12-10-SUMMARY.md`
</output>
