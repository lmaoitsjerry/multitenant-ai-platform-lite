---
phase: 12-devops-tests
plan: 12
type: execute
wave: 6
depends_on: ["12-09", "12-10"]
files_modified:
  - tests/test_inbound_routes.py
  - tests/test_templates_routes.py
  - tests/test_rag_services.py
  - tests/test_bigquery_tool.py
autonomous: true

must_haves:
  truths:
    - "Inbound routes have endpoint tests"
    - "Templates routes have endpoint tests"
    - "RAG services have unit tests"
    - "BigQuery tool has unit tests"
    - "Coverage increases by at least 7%"
  artifacts:
    - path: "tests/test_inbound_routes.py"
      provides: "Inbound email route tests"
      min_lines: 100
    - path: "tests/test_templates_routes.py"
      provides: "Templates route tests"
      min_lines: 100
    - path: "tests/test_rag_services.py"
      provides: "RAG service tests"
      min_lines: 150
    - path: "tests/test_bigquery_tool.py"
      provides: "BigQuery tool tests"
      min_lines: 150
---

<objective>
Add tests for inbound email, templates, RAG services, and BigQuery tool.

Purpose: These areas handle specialized functionality. Combined ~700 uncovered lines.

Output: 500+ lines of tests, ~7% coverage increase.
</objective>

<context>
@.planning/STATE.md
@src/api/inbound_routes.py
@src/api/templates_routes.py
@src/services/rag_response_service.py
@src/tools/bigquery_tool.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create inbound routes tests</name>
  <files>tests/test_inbound_routes.py</files>
  <action>
Create tests for inbound email webhook endpoints.

Key endpoints:
- POST /api/v1/inbound/email
- POST /api/v1/inbound/sendgrid

Mock email processing. Target: 100+ lines.
  </action>
  <verify>
pytest tests/test_inbound_routes.py -v
  </verify>
  <done>
test_inbound_routes.py created.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create templates routes tests</name>
  <files>tests/test_templates_routes.py</files>
  <action>
Create tests for email/PDF template endpoints.

Key endpoints:
- GET /api/v1/templates
- PUT /api/v1/templates/{type}
- POST /api/v1/templates/preview

Target: 100+ lines.
  </action>
  <verify>
pytest tests/test_templates_routes.py -v
  </verify>
  <done>
test_templates_routes.py created.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create RAG services tests</name>
  <files>tests/test_rag_services.py</files>
  <action>
Create tests for RAG response service.

Key methods:
- generate_response
- format_response
- classify_intent

Mock OpenAI client. Target: 150+ lines.
  </action>
  <verify>
pytest tests/test_rag_services.py -v
  </verify>
  <done>
test_rag_services.py created.
  </done>
</task>

<task type="auto">
  <name>Task 4: Create BigQuery tool tests</name>
  <files>tests/test_bigquery_tool.py</files>
  <action>
Create tests for BigQueryTool.

Key methods:
- query_analytics
- get_revenue_data
- get_conversion_metrics

Mock BigQuery client. Target: 150+ lines.
  </action>
  <verify>
pytest tests/test_bigquery_tool.py -v
  </verify>
  <done>
test_bigquery_tool.py created.
  </done>
</task>

</tasks>

<verification>
- [ ] All test files created
- [ ] All tests pass
- [ ] Coverage approaches 65%
</verification>

<success_criteria>
1. Specialized services tested
2. Coverage nearing 70% target
</success_criteria>

<output>
After completion, create `.planning/phases/12-devops-tests/12-12-SUMMARY.md`
</output>
