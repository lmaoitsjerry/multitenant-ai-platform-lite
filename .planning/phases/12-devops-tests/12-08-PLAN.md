---
phase: 12-devops-tests
plan: 08
type: execute
wave: 5
depends_on: ["12-07"]
files_modified:
  - pyproject.toml
  - .github/workflows/ci.yml
autonomous: true

must_haves:
  truths:
    - "Coverage threshold raised to 70%"
    - "CI enforces 70% minimum"
    - "All tests pass at 70% threshold"
  artifacts:
    - path: "pyproject.toml"
      provides: "Coverage config"
      contains: "fail_under = 70"
    - path: ".github/workflows/ci.yml"
      provides: "CI workflow"
      contains: "cov-fail-under=70"
---

<objective>
Finalize coverage configuration at 70% after tests are written.

Purpose: After plans 05-07 add sufficient tests, raise the coverage threshold to the required 70%. This is the final step to complete TEST-04.

Output: Updated pyproject.toml and ci.yml with 70% threshold.
</objective>

<context>
@.planning/STATE.md
@pyproject.toml
@.github/workflows/ci.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify coverage meets 70%</name>
  <files></files>
  <action>
Run full test suite with coverage:
```bash
pytest tests/ --cov=src --cov=main --cov=config --cov-report=term-missing
```

Verify total coverage is at least 70%. If not, identify remaining gaps.
  </action>
  <verify>
Coverage report shows >= 70%.
  </verify>
  <done>
Coverage verified at 70%+ before raising threshold.
  </done>
</task>

<task type="auto">
  <name>Task 2: Raise coverage threshold to 70%</name>
  <files>pyproject.toml, .github/workflows/ci.yml</files>
  <action>
Update both files:

pyproject.toml:
```toml
[tool.coverage.report]
fail_under = 70
```

.github/workflows/ci.yml:
```yaml
pytest tests/ -v --tb=short --cov=src --cov=main --cov=config --cov-report=term-missing --cov-fail-under=70
```
  </action>
  <verify>
grep "fail_under = 70" pyproject.toml
grep "cov-fail-under=70" .github/workflows/ci.yml
  </verify>
  <done>
Coverage threshold raised to 70% in both pyproject.toml and ci.yml.
  </done>
</task>

<task type="auto">
  <name>Task 3: Final verification</name>
  <files></files>
  <action>
Run tests with new threshold to confirm CI will pass:
```bash
pytest tests/ --cov=src --cov=main --cov=config --cov-fail-under=70
```
  </action>
  <verify>
Tests pass with 70% threshold enforced.
  </verify>
  <done>
Full test suite passes with 70% coverage threshold.
  </done>
</task>

</tasks>

<verification>
- [ ] pyproject.toml has fail_under = 70
- [ ] ci.yml has cov-fail-under=70
- [ ] Tests pass with 70% threshold
</verification>

<success_criteria>
1. TEST-04 requirement fully satisfied
2. 70% threshold enforced in CI
3. All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/12-devops-tests/12-08-SUMMARY.md`
</output>
